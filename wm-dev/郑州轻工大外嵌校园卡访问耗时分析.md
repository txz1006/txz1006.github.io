### 1.问题状况

近期收到学校反馈问题，校园卡嵌入i轻工大应用出现访问较慢的现场状况，经过测试复现，发现访问应用确实存在该问题状况。为此公司进行了一系列技术分析和讨论问题解决工作，内容如下。

### 2.流程分析

用户在i轻工大应用点击标准校园卡h5应用图标后，系统的访问链路如下所示：
![image-20230310144225890](https://alex-img-1253982387.cos.ap-nanjing.myqcloud.com/Typora-wm/202303101442947.png)

请求链路涉及的系统较多，任何一个环节的异常都会影响整个链路的整体消耗时长，从而影响用户的实际体验。

### 3.耗时分析

我们在手机端APP中进行了多次实测抓包，以下是一次完整的抓包数据主要内容：

![image-20230310134749448](https://alex-img-1253982387.cos.ap-nanjing.myqcloud.com/Typora-wm/202303101347647.png)

以上抓包数据格式顺序是从下向上，从左到右，具体分析如下：

- 请求日志时间从17:33:22开始，对应点击校园卡图标的时间

- 点击后，i轻工大APP进行了数据收集和统计，到跳转到B模块的时间是17:33:26，耗时是4秒时

- 身份对接模块完成身份信息互换后跳转到开放平台的时间是17:33:28，耗时是2秒

- 开放平台完成登录获取完接口权限信息后跳转到标准校园卡后台系统的时间是17:33:29，耗时是1秒

- 标准校园卡后台系统查询获取到一卡通用户信息后跳转到标准校园卡前端的时间是17:33:30，耗时1秒

整个请求链路耗时估计大概在5~8秒左右（考虑网络环境等其他因素），其中i轻工大APP在访问应用前进行了数据收集和统计，耗时大概在3~4秒，由于不了解学校APP应用的技术细节，尚不清楚这个耗时的具体原因和影响，需要学校方面协调下相关开发商进行沟通了解具体信息，是否可以进行优化调整。

之后从身份对接模块开始访问完成整个链路的请求耗时同样也是在3~4秒范围，由于涉及到账号转换登录、数据安全、接口安全等相关因素，目前系统流程短时间内无法做较大范围的改动，只能在此基础上进行局部调整，尽量减少大的耗时。

### 4.优化方案

在可进行优化的系统范围内，分别优化B模块、开放平台、标准校园卡后台、标准校园卡前端的资源请求耗时，近期的优化调整内容如下：

- 增加多级数据缓存来减轻数据库的负载，提高接口查询响应速度
- 压缩资源文件，减少网络传输的数据量
- 增加客户端用户数据缓存，大幅度减少二次进入加载速度
- 优化调整部分系统接口访问方式，减少非必要数据的加载和请求重定向

后期会逐步对整个请求链路进行系统级优化，尽量缩短链路的长度，减少可能产生异常问题的因素，提高整个链路的稳定性和访问效率。

改造完成后，预计提升效率可以达到20%~30%上下，从身份对接模块开始访问完成整个链路的请求耗时将会减少到2秒左右。